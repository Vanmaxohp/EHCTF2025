# Đề bài

```
from Crypto.Util.number import getPrime, bytes_to_long, long_to_bytes
import random

def generate_rsa_keys(bits=512):
    p = getPrime(bits)
    q = getPrime(bits)
    N = p * q
    e = 65537
    phi = (p - 1) * (q - 1)
    d = pow(e, -1, phi)
    return p, q, N, e, d

def encrypt_rsa(m, e, N):
    return pow(m, e, N)

def generate_challenge():
    p, q, N, e, d = generate_rsa_keys()
    
    flag = b"EHCTF{REDACTED}"
    m = bytes_to_long(flag)
    c = encrypt_rsa(m, e, N)
    
    e1 = getPrime(512)
    e2 = getPrime(512)
    c1 = pow(11 * p + 13 * q, e1, N)
    c2 = pow(17 * p + 19 * q, e2, N)
    
    print("=== RSA Challenge ===")
    print(f"N = {N}")
    print(f"e = {e}")
    print(f"c = {c}")
    print(f"c1 = {c1}")
    print(f"e1 = {e1}")
    print(f"c2 = {c2}")
    print(f"e2 = {e2}")

generate_challenge()
```

Ciphertext:

```
=== RSA Challenge ===
N = 89156266907466460538200146311123746435320209872333750935784210557099123190678967741613359673632829344802763408731199757109293409722062495770585640017904957394045762260360827711957390345396442294903738996712632583876064740671503696586522098920393316958039412253880631041027612404537600337997149715759664028757
e = 65537
c = 50211487993510469413078624648655863982795252968246820118003239366658450467912886912392059546221975252578245891635185924772785904614664991649808229585922853386162460253943723178200683912037494350316200308233799042350404135579996049632727567466852279389298527152970363088831506155783849294060031015169373418945
c1 = 57181933008584442135769796537042853458870011250420095105376326428822578971125875163024030604977441633051559158741452817134582306177288499985068276304933518970066703674619859803654524684770219792840687513288296986188125723939281647580035130329109308371858018312082773787688354461455892098659773182119944174424
e1 = 10805310471540522012296798055746819566490732052280714125743189332779981227665986154675562007317588829033278247071218200899862246831320919818866547393252129
c2 = 63586208196103639845106867442808513065783437037723576053366001750950493393346147776740375318297945439734123764029971396200554975241126484099842227450710315146143725100772173407879830859638546156714589330968712936477712888751687233923569831083154098024043701839799618007374709671970340394432396404713323496748
e2 = 11200128007525788210946176327195431372710554308354956166827538639178976050101307974039088762688787433244190822507863683099384665830501774865272906224939731
```

# Phân tích:

Có:
  
  $c_{1} = (a_{1} * p + b_{1} * q)^{e_{1}} \mod N$

  $c_{2} = (a_{2} * p + b_{2} * q)^{e_{2}} \mod N$

Suy ra:

  $c_{1}^{e_{2}} = (a_{1}p)^{e_{1}e_{2}} + (b_{1}q)^{e_{1}e_{2}} \mod N$
 
  $a_{1}^{-e_{1}e_{2}} * c_{1}^{e_{2}} = a_{1}^{-e_{1}e_{2}} * (a_{1}p)^{e_{1}e_{2}} + a_{1}^{-e_{1}e_{2}} * (b_{1}q)^{e_{1}e_{2}} \mod N$
  
  $a_{1}^{-e_{1}e_{2}} * c_{1}^{e_{2}} = p_{1}^{e_{1}e_{2}} + a_{1}^{-e_{1}e_{2}} * (b_{1}q)^{e_{1}e_{2}} \mod N$

Tương tự với $c_{2}$:
  
  $c_{2}^{e_{1}} = (a_{2}p)^{e_{2}e_{1}} + (b_{2}q)^{e_{2}e_{1}} \mod N$
 
  $a_{2}^{-e_{2}e_{1}} * c_{2}^{e_{1}} = a_{2}^{-e_{2}e_{1}} * (a_{2}p)^{e_{2}e_{1}} + a_{2}^{-e_{2}e_{1}} * (b_{2}q)^{e_{2}e_{1}} \mod N$
  
  $a_{2}^{-e_{2}e_{1}} * c_{2}^{e_{1}} = p_{2}^{e_{2}e_{1}} + a_{2}^{-e_{2}e_{1}} * (b_{2}q)^{e_{2}e_{1}} \mod N$

Trừ vế với vế:
  
  $a_{2}^{-e_{2}e_{1}}c_{2}^{e_{1}} - a_{1}^{-e_{1}e_{2}} * c_{1}^{e_{2}} = p_{1}^{e_{1}e_{2}} + a_{1}^{-e_{1}e_{2}} * (b_{1}q)^{e_{1}e_{2}} - p_{2}^{e_{2}e_{1}} + a_{2}^{-e_{2}e_{1}} * (b_{2}q)^{e_{2}e_{1}} \mod N$

  $a_{2}^{-e_{2}e_{1}}c_{2}^{e_{1}} - a_{1}^{-e_{1}e_{2}}c_{1}^{e_{2}} = a_{2}^{-e_{1}e_{2}} * (b_{2}q)^{e_{2}e_{1}} + a_{1}^{-e_{1}e_{2}} * (b_{1}q)^{e_{1}e_{2}} \mod N$

Dễ thấy $q$ là ước của $a_{2}^{-e_{2}e_{1}}c_{2}^{e_{1}} - a_{1}^{-e_{1}e_{2}}c_{1}^{e_{2}}$

Mà $q$ cũng là ước của $N$.

=> $q = \text{GCD}(a_{2}^{-e_{2}e_{1}}c_{2}^{e_{1}} - a_{1}^{-e_{1}e_{2}}c_{1}^{e_{2}}, \text{N})$

# Lời giải:

```
from Crypto.Util.number import *

N = 89156266907466460538200146311123746435320209872333750935784210557099123190678967741613359673632829344802763408731199757109293409722062495770585640017904957394045762260360827711957390345396442294903738996712632583876064740671503696586522098920393316958039412253880631041027612404537600337997149715759664028757
e = 65537
c = 50211487993510469413078624648655863982795252968246820118003239366658450467912886912392059546221975252578245891635185924772785904614664991649808229585922853386162460253943723178200683912037494350316200308233799042350404135579996049632727567466852279389298527152970363088831506155783849294060031015169373418945
c1 = 57181933008584442135769796537042853458870011250420095105376326428822578971125875163024030604977441633051559158741452817134582306177288499985068276304933518970066703674619859803654524684770219792840687513288296986188125723939281647580035130329109308371858018312082773787688354461455892098659773182119944174424
e1 = 10805310471540522012296798055746819566490732052280714125743189332779981227665986154675562007317588829033278247071218200899862246831320919818866547393252129
c2 = 63586208196103639845106867442808513065783437037723576053366001750950493393346147776740375318297945439734123764029971396200554975241126484099842227450710315146143725100772173407879830859638546156714589330968712936477712888751687233923569831083154098024043701839799618007374709671970340394432396404713323496748
e2 = 11200128007525788210946176327195431372710554308354956166827538639178976050101307974039088762688787433244190822507863683099384665830501774865272906224939731
a1 = 11
a2 = 17
b1 = 13
b2 = 19

q = GCD(pow(a2,(-e2 * e1),N) * pow(c2, e1, N) - pow(a1, (-e1 * e2), N) * pow(c1, e2, N), N)
p = N // q

from Crypto.Util.number import inverse

def rsa_decrypt(p, q, e, c):
    n = p * q
    
    phi_n = (p - 1) * (q - 1)
    
    d = inverse(e, phi_n)
    
    m = pow(c, d, n)
    
    return long_to_bytes(m)

plaintext = rsa_decrypt(p, q, e, c)
print("Plaintext:", plaintext)
```

# Flag:

`EHCTF{5uu64ku_w4_4nz3n_n4_w4k3_j4n41_y0_n3?}`
